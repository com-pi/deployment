apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: comppi
  annotations:
    argocd-image-updater.argoproj.io/image-list: >-
      utopiandrmer/comppi-mysql,
      redis=utopiandrmer/comppi-redis,
      my-plant=utopiandrmer/comppi-my-plant,
      auth-service=utopiandrmer/comppi-auth-service,
      api-gateway=utopiandrmer/comppi-api-gateway,
      discovery-eureka=utopiandrmer/comppi-discovery-eureka,
      board-service=utopiandrmer/comppi-board-service,
      scraper=utopiandrmer/comppi-scraper,
      encyclo-service,utopiandrmer/comppi-encyclo-service
    {{- range .Values.images }}
    argocd-image-updater.argoproj.io/{{ . }}.update-strategy: newest-build
    {{- end }}
spec:
  destination:
    name: ''
    namespace: comppi-dev
    server: 'https://kubernetes.default.svc'
  source:
    path: helm-chart/comppi
    repoURL: 'git@github.com:com-pi/deployment.git'
    targetRevision: main
    helm:
      valueFiles:
        - values-dev.yaml
  project: default
  syncPolicy:
    automated:
      prune: false
      selfHeal: false
    syncOptions:
      - CreateNamespace=true
