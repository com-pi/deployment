# 어플리케이션 설정
releaseName: comppi
env:
  activeProfile: dev
  timezone: Asia/Seoul

docker:
  account: utopiandrmer

application:
  api-gateway:
    replicaCount: 1
    port: 8000
    initContainers:
      - name: init-wait-for-discovery
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 discovery-eureka 8761; do echo "Waiting for Discovery..."; sleep 5; done' ]

  auth-service:
    replicaCount: 1
    initContainers:
      - name: init-wait-for-discovery
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 discovery-eureka 8761; do echo "Waiting for Discovery..."; sleep 5; done' ]

  board-service:
    replicaCount: 1
    initContainers:
      - name: init-wait-for-discovery
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 discovery-eureka 8761; do echo "Waiting for Discovery..."; sleep 5; done' ]

  encyclo-service:
    replicaCount: 1
    initContainers:
      - name: init-wait-for-discovery
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 discovery-eureka 8761; do echo "Waiting for Discovery..."; sleep 5; done' ]

  my-plant:
    replicaCount: 1
    initContainers:
      - name: init-wait-for-discovery
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 discovery-eureka 8761; do echo "Waiting for Discovery..."; sleep 5; done' ]

  discovery-eureka:
    replicaCount: 1
    port: 8761
    initContainers:
      - name: init-wait-for-mysql
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 mysql 3306; do echo "Waiting for MySQL..."; sleep 5; done' ]
      - name: init-wait-for-redis
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 redis 6379; do echo "Waiting for Redis..."; sleep 5; done' ]
      - name: init-wait-for-mongodb
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 mongodb 27017; do echo "Waiting for MongoDB..."; sleep 5; done' ]
      - name: init-wait-for-minio
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 minio 9000; do echo "Waiting for Minio..."; sleep 5; done' ]
      - name: init-wait-for-scraper
        image: busybox
        command: [ 'sh', '-c', 'until nc -z -v -w30 scraper 8080; do echo "Waiting for Scraper..."; sleep 5; done' ]

database:
  mysql:
    ports:
      - 3306
    nodePorts:
      - port: 3306
        nodePort: 32306
    env:
      - name: MYSQL_ROOT_PASSWORD
        valueFrom:
          secretKeyRef:
            name: comppi-secret
            key: MYSQL_ROOT_PASSWORD
    volumeMount:
      - name: vol1
        mountPath: "/var/lib/mysql"
        capacity: 10Gi
        nfs:
          path: /srv/nfs/kubedata/mysql
          server: 172.30.1.60

  minio:
    ports:
      - 9000
      - 9001
    nodePorts:
      - port: 9001
        nodePort: 30901
    env:
      - name: MINIO_ROOT_USER
        value: "admin"
      - name: MINIO_ROOT_PASSWORD
        valueFrom:
          secretKeyRef:
            name: comppi-secret
            key: MINIO_ROOT_PASSWORD
    command: [ "minio", "server", "/data", "--console-address", ":9001" ]
    volumeMount:
      - name: minio-vol1
        mountPath: /data
        capacity: 20Gi
        nfs:
          path: /srv/nfs/kubedata/minio
          server: 172.30.1.60

nginx:
  ports:
    - 443
    - 80
  nodePorts:
    - name: https
      port: 443
      nodePort: 30443
    - name: http
      port: 80
      nodePort: 30480
